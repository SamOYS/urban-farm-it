{%- liquid
  assign number_of_comments = article.comments_count
  if comment.status == 'pending'
    assign number_of_comments = article.comments_count | plus: 1
  endif
-%}

{% render 'article-custom-hero' %}

{% liquid
  assign content_block = article.metafields.content_block
  assign block_type = content_block.type
  assign block_heading = content_block.heading
  assign block_heading_type = content_block.heading_type
  assign block_heading_alignment = content_block.heading_alignment
  assign block_image = content_block.image
  assign block_content = content_block.html_content
  assign block_reverse_direction = content_block.reverse

  assign len = block_type.size | minus: 1
%}

<div
        id="article_wrapper"
        class="grid page-width page-width--article page-content"
        style="display: flex; gap: 1.5rem;">
  {% comment %} {% render 'contents-bar-old', len: len, block_heading: block_heading, block_heading_type: block_heading_type %} {% endcomment %}

  <article class="article">
    <div class="article__body rte">
      {%- assign paragraphs = article.content | split: '</p>' -%}
      {%- assign midpoint = paragraphs.size | divided_by: 2 -%}

      {%- for paragraph in paragraphs -%}
        {{ paragraph }}</p>

        {% if forloop.index == midpoint %}
          <!-- CTA Block -->
            {% if article.metafields.custom.blog_cta_link %}
                {% assign cta_link = article.metafields.custom.blog_cta_link.value | parse_json %}
                <a class="!tw-border-none !tw-static !tw-no-underline !tw-mb-8 !tw-mt-4 md:!tw-mb-10" href="{{ cta_link.url }}">
                <div class="cta-block tw-gap-2 tw-p-6 md:tw-p-8 md:tw-flex tw-rounded-md tw-items-center tw-text-center tw-shadow-sm" style="background-color: {{ article.metafields.custom.blog_cta_colour }}; border: solid hsla(206, 7%, 44%, .3);">
                    <div class="md:tw-w-[40%] tw-w-full">
                      {% if article.metafields.custom.blog_cta_image %}
                          <img class="lg:!tw-h-[325px] tw-mx-auto md:tw-mx-0 !tw-h-[250px] tw-w-auto" src="{{ article.metafields.custom.blog_cta_image | img_url: '1200x1200' }}" alt="CTA Image">
                      {% endif %}
                    </div>
                    <div class="md:tw-w-[60%] tw-mt-2 md:tw-mt-0 tw-w-full">
                      {% if article.metafields.custom.blog_cta_text %}
                        <h2 class="!tw-mb-4 h2 !tw-text-black">{{ article.metafields.custom.blog_cta_text }}</h2>
                      {% endif %}
                        <span class="btn !tw-w-full md:!tw-w-1/2 !tw-rounded-full !tw-bg-[#0560C7] !tw-border-[#0560C7] !tw-text-white !tw-normal-case !tw-font-normal !tw-tracking-normal !tw-text-xs sm:!tw-text-sm md:!tw-text-base">
                          {{ cta_link.text }}
                        </span>
                    </div>
                  </div>
                </a>
            {% endif %}

        {% endif %}
      {%- endfor -%}

      {%- for i in (0..len) -%}
        {%- assign block_id = i -%}
        {% case block_type[i] %}
                <!--           {% when 'text-image' %}
          {% render 'article-content-block__text-image',
                image: block_image[i],
                subheading: block_subheading[i],
                text: block_text[i],
                reverse_col: reverse_col_direction[i],
                block_id: block_id
        %} -->
          {% when 'full-width' %}
            {% render 'article-content-block__text'
                    , heading: block_heading[i],
                    heading_type: block_heading_type[i],
                    content: block_content[i],
                    block_id: block_id %}
        {% endcase %}
      {%- endfor -%}

    </div>

    {%- if section.settings.social_sharing_blog -%}
      {%- render 'social-sharing'
              , share_title: article.title,
              share_permalink: article.url,
              share_image: article.image -%}
    {%- endif -%}

    {%- if blog.comments_enabled? -%}
      {%- if number_of_comments > 0 -%}
        <hr class="hr--large">
        <h3>{{ 'blogs.comments.with_count' | t: count: number_of_comments }}</h3>
        <hr class="hr--small hr--clear">
      {%- endif -%}

      {%- paginate article.comments by 5 -%}
        <div id="comments">
          {%- if comment and comment.errors == blank -%}
            <hr class="hr--small hr--clear">
            <p class="note note--success">
              {%- if blog.moderated? -%}
                {{ 'blogs.comments.success_moderated' | t }}
              {%- else -%}
                {{ 'blogs.comments.success' | t }}
              {%- endif -%}
            </p>
          {%- endif -%}

          {%- if number_of_comments > 0 -%}
            <ul class="no-bullets">
              {%- if comment.status == 'pending' -%}
                <li id="Comment-{{ comment.id }}" class="article__comment">
                  {%- render 'comment', comment: comment -%}
                </li>
              {%- endif -%}

              {%- for comment in article.comments -%}
                <li id="Comment-{{ comment.id }}" class="article__comment">
                  {%- render 'comment', comment: comment -%}
                </li>

                {%- unless forloop.last -%}
                  <li><hr class="hr--clear"></li>
                {%- endunless -%}
              {%- endfor -%}
            </ul>

            {%- if paginate.pages > 1 -%}
              {%- render 'pagination', paginate: paginate, hash: '#comments' -%}
            {%- endif -%}
          {%- endif -%}

          <hr class="hr--large">

          <header class="section-header{% unless settings.type_headers_align_text %} section-header--with-link{% endunless %}">
            <h3 class="section-header__title">{{ 'blogs.comments.title' | t }}</h3>
          </header>

          <div class="form-vertical">
            {%- form 'new_comment', article -%}
              {{ form.errors | default_errors }}

              <div class="grid grid--small">
                <div class="grid__item medium-up--one-half">
                  <label for="CommentAuthor">{{ 'blogs.comments.name' | t }}</label>
                  <input
                          class="input-full{% if form.errors contains 'author' %} error{% endif %}"
                          type="text"
                          name="comment[author]"
                          id="CommentAuthor"
                          value="{{ form.author }}"
                          autocapitalize="words">
                </div>
                <div class="grid__item medium-up--one-half">
                  <label for="CommentEmail">{{ 'blogs.comments.email' | t }}</label>
                  <input
                          class="input-full{% if form.errors contains 'email' %} error{% endif %}"
                          type="email"
                          name="comment[email]"
                          id="CommentEmail"
                          value="{{ form.email }}"
                          autocorrect="off"
                          autocapitalize="off">
                </div>
              </div>

              <label for="CommentBody">{{ 'blogs.comments.message' | t }}</label>
              <textarea
                      class="input-full{% if form.errors contains 'body' %} error{% endif %}"
                      name="comment[body]"
                      id="CommentBody">{{ form.body }}</textarea>

              {%- if blog.moderated? -%}
                <p>
                  <small>{{ 'blogs.comments.moderated' | t }}</small>
                </p>
              {%- endif -%}

              <button type="submit" class="btn btn--secondary">
                {{ 'blogs.comments.post' | t }}
              </button>

              {{ 'shopify.online_store.spam_detection.disclaimer_html' | t }}
            {%- endform -%}
          </div>
        </div>
      {%- endpaginate -%}
    {%- endif -%}

    <hr class="hr--large">
  </article>
</div>
